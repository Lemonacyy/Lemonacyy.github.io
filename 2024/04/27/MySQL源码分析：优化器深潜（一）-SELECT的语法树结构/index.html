<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"lemonacyy.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="优化器是一个非常复杂的模块，我将优化器的分析分为三篇，分别是前瞻（语法树结构）、重写、和优化。 语法树的解析属于parser的部分，但优化器会对语法树进行解析（resolve）和变换（transform），所以在这里也需要介绍语法树的相关内容。 本文是第一部分：SELECT的语法树结构。">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL源码分析：优化器深潜（一）- SELECT的语法树结构">
<meta property="og:url" content="https://lemonacyy.github.io/2024/04/27/MySQL%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%9A%E4%BC%98%E5%8C%96%E5%99%A8%E6%B7%B1%E6%BD%9C%EF%BC%88%E4%B8%80%EF%BC%89-SELECT%E7%9A%84%E8%AF%AD%E6%B3%95%E6%A0%91%E7%BB%93%E6%9E%84/index.html">
<meta property="og:site_name" content="LEMONACY&#39;S HOUSE">
<meta property="og:description" content="优化器是一个非常复杂的模块，我将优化器的分析分为三篇，分别是前瞻（语法树结构）、重写、和优化。 语法树的解析属于parser的部分，但优化器会对语法树进行解析（resolve）和变换（transform），所以在这里也需要介绍语法树的相关内容。 本文是第一部分：SELECT的语法树结构。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pic.imgdb.cn/item/662c94760ea9cb140331c7e7.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/662c97b20ea9cb1403390cfc.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/662c995f0ea9cb14033cd4d4.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/662c99600ea9cb14033cd5c1.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/662c99600ea9cb14033cd61c.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/662c99600ea9cb14033cd671.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/662c99960ea9cb14033d4d4f.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/662c99970ea9cb14033d4dda.png">
<meta property="article:published_time" content="2024-04-27T05:45:54.993Z">
<meta property="article:modified_time" content="2024-04-27T06:28:49.054Z">
<meta property="article:author" content="lemonacy">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic.imgdb.cn/item/662c94760ea9cb140331c7e7.png">

<link rel="canonical" href="https://lemonacyy.github.io/2024/04/27/MySQL%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%9A%E4%BC%98%E5%8C%96%E5%99%A8%E6%B7%B1%E6%BD%9C%EF%BC%88%E4%B8%80%EF%BC%89-SELECT%E7%9A%84%E8%AF%AD%E6%B3%95%E6%A0%91%E7%BB%93%E6%9E%84/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>MySQL源码分析：优化器深潜（一）- SELECT的语法树结构 | LEMONACY'S HOUSE</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">LEMONACY'S HOUSE</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Make Lemons into Lemonade</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-日记">

    <a href="/diary/" rel="section"><i class="fa fa-archive fa-fw"></i>日记</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lemonacyy.github.io/2024/04/27/MySQL%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%9A%E4%BC%98%E5%8C%96%E5%99%A8%E6%B7%B1%E6%BD%9C%EF%BC%88%E4%B8%80%EF%BC%89-SELECT%E7%9A%84%E8%AF%AD%E6%B3%95%E6%A0%91%E7%BB%93%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="lemonacy">
      <meta itemprop="description" content="Make Lemons into Lemonade">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LEMONACY'S HOUSE">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MySQL源码分析：优化器深潜（一）- SELECT的语法树结构
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-04-27 13:45:54 / 修改时间：14:28:49" itemprop="dateCreated datePublished" datetime="2024-04-27T13:45:54+08:00">2024-04-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>优化器是一个非常复杂的模块，我将优化器的分析分为三篇，分别是前瞻（语法树结构）、重写、和优化。</p>
<p>语法树的解析属于parser的部分，但优化器会对语法树进行解析（resolve）和变换（transform），所以在这里也需要介绍语法树的相关内容。</p>
<p>本文是第一部分：SELECT的语法树结构。</p>
<span id="more"></span>

<blockquote>
<p>代码基于MySQL8.0.32。</p>
</blockquote>
<h1 id="0-序"><a href="#0-序" class="headerlink" title="0 序"></a>0 序</h1><p>MySQL的查询优化器是一个非常高级的系统组件，它的主要作用是为数据库优化器提供最佳执行计划，以实现最优查询性能。在MySQL中，优化器负责以下几个方面的工作：</p>
<ul>
<li>语法分析和语义检查：在查询语句输入后，优化器会首先对语句进行语法分析和语义检查，以确保查询语句的合法性和正确性。</li>
<li>查询重写：当用户提交一个查询时，优化器会分析查询的语句，然后对其进行优化重写，生成一个新的查询语句，以提高查询性能。</li>
<li>查询优化：优化器会考虑多种可能的查询路径，并通过成本估计器来计算每个路径的成本。然后，它会选择最佳的查询路径，以确保查询在最短时间内完成。</li>
<li>查询执行：优化器将优化后的查询语句传递给执行引擎，执行引擎则会执行查询计划，返回结果。</li>
</ul>
<p>也就是说优化器的输入是一个语法树，输出是一个执行树（也称为执行计划）。</p>
<h1 id="1-相关概念"><a href="#1-相关概念" class="headerlink" title="1 相关概念"></a>1 相关概念</h1><p>词法扫描器将 SQL 语句字符串分解为 tokens，语法分析器将 tokens 组装成语法树的子树结构，并 Reduce 为基本查询结构，最终生成 SQL 语法解析树。</p>
<h2 id="1-1-query-specification"><a href="#1-1-query-specification" class="headerlink" title="1.1 query specification"></a>1.1 query specification</h2><p>MySQL中对于一个<code>query block</code>的描述结构，代码中常见为select&#x2F;query_block。</p>
<p>对应<code>&lt;query specification&gt;</code>用以描述查询规范或定义，表示一个 SELECT主体部分，通常包括查询的各个组成部分，例如要选择的列、查询的表、过滤条件等。</p>
<p><code>query specification</code>有prepare和optimize方法，没有execute方法，<code>query expression</code>（1.2介绍）有execute方法。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  [<span class="keyword">DISTINCT</span> <span class="operator">|</span> <span class="keyword">ALL</span>] select_list</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  table_reference</span><br><span class="line">[<span class="keyword">WHERE</span></span><br><span class="line">  search_condition]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">  grouping_column_reference,...]</span><br><span class="line">[<span class="keyword">HAVING</span></span><br><span class="line">  search_condition]</span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">  order_column_reference [<span class="keyword">ASC</span> <span class="operator">|</span> <span class="keyword">DESC</span>],...];</span><br></pre></td></tr></table></figure>

<p><code>&lt;query specification&gt;</code>的BNF文法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">query_specification:</span><br><span class="line">          SELECT_SYM</span><br><span class="line">          select_options</span><br><span class="line">          select_item_list</span><br><span class="line">          into_clause</span><br><span class="line">          opt_from_clause</span><br><span class="line">          opt_where_clause</span><br><span class="line">          opt_group_clause</span><br><span class="line">          opt_having_clause</span><br><span class="line">          opt_window_clause</span><br><span class="line">          &#123;</span><br><span class="line">            $$= NEW_PTN PT_query_specification(</span><br><span class="line">                                      $1,  // SELECT_SYM</span><br><span class="line">                                      $2,  // select_options</span><br><span class="line">                                      $3,  // select_item_list</span><br><span class="line">                                      $4,  // into_clause</span><br><span class="line">                                      $5,  // from</span><br><span class="line">                                      $6,  // where</span><br><span class="line">                                      $7,  // group</span><br><span class="line">                                      $8,  // having</span><br><span class="line">                                      $9,  // windows</span><br><span class="line">                                      @5.raw.is_empty()); // implicit FROM</span><br><span class="line">          &#125;</span><br><span class="line">        | SELECT_SYM</span><br><span class="line">          select_options</span><br><span class="line">          select_item_list</span><br><span class="line">          opt_from_clause</span><br><span class="line">          opt_where_clause</span><br><span class="line">          opt_group_clause</span><br><span class="line">          opt_having_clause</span><br><span class="line">          opt_window_clause</span><br><span class="line">          &#123;</span><br><span class="line">            $$= NEW_PTN PT_query_specification(</span><br><span class="line">                                      $1,  // SELECT_SYM</span><br><span class="line">                                      $2,  // select_options</span><br><span class="line">                                      $3,  // select_item_list</span><br><span class="line">                                      NULL,// no INTO clause</span><br><span class="line">                                      $4,  // from</span><br><span class="line">                                      $5,  // where</span><br><span class="line">                                      $6,  // group</span><br><span class="line">                                      $7,  // having</span><br><span class="line">                                      $8,  // windows</span><br><span class="line">                                      @4.raw.is_empty()); // implicit FROM</span><br><span class="line">          &#125;</span><br><span class="line">        ;</span><br></pre></td></tr></table></figure>

<h2 id="1-2-query-expression"><a href="#1-2-query-expression" class="headerlink" title="1.2 query expression"></a>1.2 query expression</h2><p>MySQL中对于一个<code>query expression</code>的描述结构，代码中常见简称为unit。</p>
<p><code>Query_expression</code>对应<code>&lt;query expression&gt;</code>用于描述查询表达式。</p>
<p>一个<code>query expression</code>表示一组由UNION &#x2F; INTERSECT &#x2F; EXCEPT等SELECT级别的逻辑操作组合成的一组SELECT结构，不过目前仅支持UNION、INTERSECT和EXCEPT，因此只是简单的列表结构。同时<code>query expression</code>也根据query的结构形成递归包含关系。</p>
<p>一个<code>query expression</code>中可能包含多个<code>query specification</code>，而<code>query specification</code>内部则也可能嵌套包含其他<code>query expression</code>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">SELECT</span> column1 <span class="keyword">FROM</span> table1 <span class="keyword">WHERE</span> condition1)</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line">(<span class="keyword">SELECT</span> column2 <span class="keyword">FROM</span> table2 <span class="keyword">WHERE</span> condition2);</span><br></pre></td></tr></table></figure>

<p>SQL 表达式可能是一条简单的 SELECT，也可能是多条SELECT的代数运算，例如: UNION、INTERSET 或者EXCEPT 运算。所以<code>Query_expression</code>的数据结构中主要维护的是表达式或者语句之间关系，而<code>Query_block (query specification)</code> 代表的是某条具体的SQL。</p>
<p><code>&lt;query expression&gt;</code>的BNF文法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">query_expression:</span><br><span class="line">          query_expression_body</span><br><span class="line">          opt_order_clause</span><br><span class="line">          opt_limit_clause</span><br><span class="line">          &#123;</span><br><span class="line">            $$ = NEW_PTN PT_query_expression($1.body, $2, $3);</span><br><span class="line">          &#125;</span><br><span class="line">        | with_clause</span><br><span class="line">          query_expression_body</span><br><span class="line">          opt_order_clause</span><br><span class="line">          opt_limit_clause</span><br><span class="line">          &#123;</span><br><span class="line">            $$= NEW_PTN PT_query_expression($1, $2.body, $3, $4);</span><br><span class="line">          &#125;</span><br><span class="line">        ;</span><br><span class="line"></span><br><span class="line">query_expression_body:</span><br><span class="line">          query_primary</span><br><span class="line">          &#123;</span><br><span class="line">            $$ = &#123;$1, false&#125;;</span><br><span class="line">          &#125;</span><br><span class="line">        | query_expression_parens %prec SUBQUERY_AS_EXPR</span><br><span class="line">          &#123;</span><br><span class="line">            $$ = &#123;$1, true&#125;;</span><br><span class="line">          &#125;</span><br><span class="line">        | query_expression_body UNION_SYM union_option query_expression_body</span><br><span class="line">          &#123;</span><br><span class="line">            $$ = &#123;NEW_PTN PT_union($1.body, $3, $4.body, $4.is_parenthesized),</span><br><span class="line">                  false&#125;;</span><br><span class="line">          &#125;</span><br><span class="line">        | query_expression_body EXCEPT_SYM union_option query_expression_body</span><br><span class="line">          &#123;</span><br><span class="line">            $$ = &#123;NEW_PTN PT_except($1.body, $3, $4.body, $4.is_parenthesized),</span><br><span class="line">                  false&#125;;</span><br><span class="line">          &#125;</span><br><span class="line">        | query_expression_body INTERSECT_SYM union_option query_expression_body</span><br><span class="line">          &#123;</span><br><span class="line">            $$ = &#123;NEW_PTN PT_intersect($1.body, $3, $4.body, $4.is_parenthesized),</span><br><span class="line">                  false&#125;;</span><br><span class="line">          &#125;</span><br><span class="line">        ;</span><br><span class="line"></span><br><span class="line">query_expression_parens:</span><br><span class="line">          &#x27;(&#x27; query_expression_parens &#x27;)&#x27;                       &#123; $$ = $2; &#125;</span><br><span class="line">        | &#x27;(&#x27; query_expression_with_opt_locking_clauses&#x27;)&#x27;      &#123; $$ = $2; &#125;</span><br><span class="line">        ;</span><br><span class="line"></span><br><span class="line">query_primary:</span><br><span class="line">          query_specification</span><br><span class="line">          &#123;</span><br><span class="line">            // Bison doesn&#x27;t get polymorphism.</span><br><span class="line">            $$= $1;</span><br><span class="line">          &#125;</span><br><span class="line">        | table_value_constructor</span><br><span class="line">          &#123;</span><br><span class="line">            $$= NEW_PTN PT_table_value_constructor($1);</span><br><span class="line">          &#125;</span><br><span class="line">        | explicit_table</span><br><span class="line">          &#123;</span><br><span class="line">            auto item_list= NEW_PTN PT_select_item_list;</span><br><span class="line">            auto asterisk= NEW_PTN Item_asterisk(@$, nullptr, nullptr);</span><br><span class="line">            if (item_list == nullptr || asterisk == nullptr ||</span><br><span class="line">                item_list-&gt;push_back(asterisk))</span><br><span class="line">              MYSQL_YYABORT;</span><br><span class="line">            $$= NEW_PTN PT_explicit_table(&#123;&#125;, item_list, $1);</span><br><span class="line">          &#125;</span><br><span class="line">        ;</span><br></pre></td></tr></table></figure>

<h2 id="1-3-示意图"><a href="#1-3-示意图" class="headerlink" title="1.3 示意图"></a>1.3 示意图</h2><p><img src="https://pic.imgdb.cn/item/662c94760ea9cb140331c7e7.png" alt="Item_example"></p>
<p>图中用括号圈起来的部分，就是一个UNIT<code>(Query_expression)</code>，而每个SELECT token开始的一个查询块，就是一个<code>query specification</code>，而在外层的<code>query specification</code>中，会嵌套子查询，用一个<code>query expression</code>描述，子查询中可以是任意查询形态，再包含多个<code>query specification</code>，从而形成<code>query expression -&gt; query specification -&gt; query expression -&gt; query specification</code> … 这种相互嵌套的结构。</p>
<p><code>derived table</code>就是图中FROM字句中的tt，对应<code>query_expression2</code>和内部的<code>query specification3/4</code>。</p>
<p>Item是MySQL的一个基础对象，MySQL中对于<code>query expression</code>的描述结构，例如on条件&#x2F;where条件&#x2F;having&#x2F;投影列等，都是用这个类来描述一个个表达式的。这里先介绍一个概念，更详细的Item架构本文放在2.4来介绍。</p>
<blockquote>
<p>需要注意select item list和item并不是一个东西，根据<code>query_specification</code>的BNF范式，只有select的列才是select item list（之后会是<code>query_block</code>中的field</p>
</blockquote>
<h1 id="2-重要数据结构"><a href="#2-重要数据结构" class="headerlink" title="2 重要数据结构"></a>2 重要数据结构</h1><h2 id="2-1-查询块Query-block"><a href="#2-1-查询块Query-block" class="headerlink" title="2.1 查询块Query_block"></a>2.1 查询块Query_block</h2><p><code>query specification</code>在代码中对应的结构是<code>Query_block</code>。</p>
<p>一个查询块对应着一条基本的SELECT语句的语法结构。</p>
<ul>
<li>master：指向查询块的上层表达式（外部查询表达式）</li>
<li>slave：执行属于该查询块的第一个查询表达式（子查询）</li>
<li>neighbors：link_next、link_prev分别指向同层同级别的邻居查询块、查询块列表</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Query_block</span> : <span class="keyword">public</span> Query_term &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    Intrusive linked list of all query blocks within the same</span></span><br><span class="line"><span class="comment">    query expression.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  Query_block *next&#123;<span class="literal">nullptr</span>&#125;;</span><br><span class="line">  <span class="comment">/// The query expression containing this query block.</span></span><br><span class="line">  Query_expression *master&#123;<span class="literal">nullptr</span>&#125;;</span><br><span class="line">  <span class="comment">/// The first query expression contained within this query block.</span></span><br><span class="line">  Query_expression *slave&#123;<span class="literal">nullptr</span>&#125;;</span><br><span class="line">  <span class="comment">/// Intrusive double-linked global list of query blocks.</span></span><br><span class="line">  Query_block *link_next&#123;<span class="literal">nullptr</span>&#125;;</span><br><span class="line">  Query_block **link_prev&#123;<span class="literal">nullptr</span>&#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="function">Query_expression *<span class="title">master_query_expression</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> master; &#125;</span><br><span class="line">  <span class="function">Query_expression *<span class="title">first_inner_query_expression</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> slave; &#125;</span><br><span class="line">  <span class="function">Query_block *<span class="title">outer_query_block</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> master-&gt;<span class="built_in">outer_query_block</span>(); &#125;</span><br><span class="line">  <span class="function">Query_block *<span class="title">next_query_block</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> next; &#125;</span><br><span class="line">  <span class="function">Query_block *<span class="title">next_select_in_list</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> link_next; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-查询表达式Query-expression"><a href="#2-2-查询表达式Query-expression" class="headerlink" title="2.2 查询表达式Query_expression"></a>2.2 查询表达式Query_expression</h2><p><code>query expression</code>在代码中对应的结构叫<code>Query_expression</code>。</p>
<p>查询式中的查询块形成一个树形结构，表达了嵌套形式的查询操作。</p>
<p>查询表达式由一个或多个查询块组成，多个查询块表示查询表达式有UNION、INTERSECT、EXCEPT操作，或者利用查询块来描述子查询结构。</p>
<ul>
<li>master：指向查询表达式的上层查询块（外部查询块）</li>
<li>slave：执行属于该表达式的第一个查询块</li>
<li>neighbors：next、prev分别指向同层同级别的邻居查询表达式、查询表达式列表。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Query_expression</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    Intrusive double-linked list of all query expressions</span></span><br><span class="line"><span class="comment">    immediately contained within the same query block.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  Query_expression *next;</span><br><span class="line">  Query_expression **prev;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    The query block wherein this query expression is contained,</span></span><br><span class="line"><span class="comment">    NULL if the query block is the outer-most one.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  Query_block *master;</span><br><span class="line">  <span class="comment">/// The first query block in this query expression.</span></span><br><span class="line">  Query_block *slave;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/// @return the query block this query expression belongs to as subquery</span></span><br><span class="line">  <span class="function">Query_block *<span class="title">outer_query_block</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> master; &#125;</span><br><span class="line">  <span class="comment">/// @return the first query block inside this query expression</span></span><br><span class="line">  <span class="function">Query_block *<span class="title">first_query_block</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> slave; &#125;</span><br><span class="line">  <span class="comment">/// @return the next query expression within same query block (next subquery)</span></span><br><span class="line">  <span class="function">Query_expression *<span class="title">next_query_expression</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> next; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-LEX"><a href="#2-3-LEX" class="headerlink" title="2.3 LEX"></a>2.3 LEX</h2><p>从LEX可以定位到语法树中最外层的查询表达式和第一个查询块，也可以直接遍历所有的查询块。</p>
<p>然后根据以上查询块和查询表达式的关系，从最外层的查询表达式的第一个查询块进行查询处理。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">LEX</span> : <span class="keyword">public</span> Query_tables_list &#123;</span><br><span class="line">  Query_expression *unit;  <span class="comment">///&lt; Outer-most query expression</span></span><br><span class="line">  <span class="comment">/// @todo: query_block can be replaced with unit-&gt;first-select()</span></span><br><span class="line">  Query_block *query_block;            <span class="comment">///&lt; First query block</span></span><br><span class="line">  Query_block *all_query_blocks_list;  <span class="comment">///&lt; List of all query blocks</span></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  <span class="comment">/* current Query_block in parsing */</span></span><br><span class="line">  Query_block *m_current_query_block;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-4-Item"><a href="#2-4-Item" class="headerlink" title="2.4 Item"></a>2.4 Item</h2><p>Item是MySQL的一个基础对象，MySQL中对于<code>query expression</code>的描述结构，例如on条件&#x2F;where条件&#x2F;having&#x2F;投影列等，都是用这个类来描述一个个表达式的。</p>
<p>Item系统是MySQL SQL层代码中最为复杂的子系统之一。Item是一个基础类，在他的基础上派生了很多子孙。这些子类基本描述所有SQL语句中的对象：</p>
<ul>
<li>一个文本字符串&#x2F;数值对象 </li>
<li>一个数据表的某一列（例如，select c1,c2 from dual…中的c1，c2）</li>
<li>一个比较动作，例如c1&gt;10</li>
<li>一个WHERE子句的所有信息</li>
<li>…</li>
</ul>
<p>在语法解析树中，这些Item以一颗树的形式存在，大量的 Item 结构 MySQL 源码使用一个 Item 基类来表示在关系查询中出现的任意类型的expression (表达式)。</p>
<p>Item类作为一个抽象类，定义了一套基本的接口行为，通过继承与多态，Item的子类实现对通用接口的重载从而完成特定功能的封装。</p>
<p>从类的继承关系角度来看，下面一些常见的继承Item的子类：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Class Item</span><br><span class="line">+--Item_row</span><br><span class="line">+--Item_basic_constant</span><br><span class="line">   +--Item_num</span><br><span class="line">      +--Item_int</span><br><span class="line">      +--Item_decimal</span><br><span class="line">      +--Item_float</span><br><span class="line">   +--Item_null</span><br><span class="line">   +--Item_string</span><br><span class="line">   +--Item_json</span><br><span class="line">   +--..</span><br><span class="line">+--Item_ident</span><br><span class="line">   +--Item_field</span><br><span class="line">   +--Item_ref</span><br><span class="line">+--Item_param</span><br><span class="line">+--Item_result_field</span><br><span class="line">   +--Item_subselect</span><br><span class="line">      +--Item_singlerow_subselect</span><br><span class="line">      +--Item_exists_subselect</span><br><span class="line">   +--Item_func</span><br><span class="line">      +--Item_str_func</span><br><span class="line">      +--Item_sum</span><br><span class="line">      +--Item_timeval_func</span><br><span class="line">      +--...</span><br><span class="line">+--...</span><br></pre></td></tr></table></figure>

<blockquote>
<p>推荐阅读：<a target="_blank" rel="noopener" href="https://www.orczhou.com/index.php/2012/11/more-about-mysql-item/">MySQL源代码：关于MySQL的Item对象</a></p>
</blockquote>
<p>可以看到，Item基本上代码SQL语句中的所有对象，例如<code>Item_sum</code>描述sum函数&#x2F;<code>Item_like</code>描述LIKE字符匹配函数Item系统构成了表达式树。</p>
<p>例如下面的SQL语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">UPPER</span>(column1) <span class="keyword">FROM</span> t <span class="keyword">WHERE</span> column2 <span class="operator">=</span> <span class="variable">@x</span>;</span><br></pre></td></tr></table></figure>

<p>MySQL需要一系列的Item来描述上面的SQL：一个描述column1对象，描述UPPER函数的对象，还有描述WHERE语句的几个相关的Item对象。Item对象可以理解做一个特殊的数据对象。</p>
<p>再例如一个WHERE条件：</p>
<p><img src="https://pic.imgdb.cn/item/662c97b20ea9cb1403390cfc.png" alt="where_example"></p>
<blockquote>
<p>source: <a target="_blank" rel="noopener" href="https://www.orczhou.com/index.php/2012/11/more-about-mysql-item/">https://www.orczhou.com/index.php/2012/11/more-about-mysql-item/</a></p>
</blockquote>
<h1 id="3-语法树示例"><a href="#3-语法树示例" class="headerlink" title="3 语法树示例"></a>3 语法树示例</h1><p>语法树示例大量参照了CSDN博主<code>抡着鼠标扛大旗</code>的博客<a target="_blank" rel="noopener" href="https://blog.csdn.net/u010502974/article/details/134996395">【MySQL·8.0·源码】MySQL 语法树结构</a>，在原作者的基础上丰富了一些语法树的架构图，在此向原作者表示感谢！</p>
<p>e.g1：UNION+ORDER BY</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1 <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t2</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t3 <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/662c995f0ea9cb14033cd4d4.png" alt="eg1"></p>
<p>e.g2：UNION+INTERSECT+EXCEPT+ORDER BY+LIMIT</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">((</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t1</span><br><span class="line">    <span class="keyword">UNION</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t2</span><br><span class="line">    <span class="keyword">UNION</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t3</span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> c1 LIMIT <span class="number">5</span></span><br><span class="line">  )</span><br><span class="line">  <span class="keyword">INTERSECT</span> </span><br><span class="line">  (((</span><br><span class="line">      <span class="keyword">SELECT</span>  <span class="operator">*</span></span><br><span class="line">      <span class="keyword">FROM</span> t3</span><br><span class="line">      <span class="keyword">ORDER</span> <span class="keyword">BY</span> c1</span><br><span class="line">      LIMIT <span class="number">1</span></span><br><span class="line">    )</span><br><span class="line">   )</span><br><span class="line">   <span class="keyword">EXCEPT</span></span><br><span class="line">      <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t4 </span><br><span class="line">  )</span><br><span class="line">  <span class="keyword">ORDER</span> <span class="keyword">BY</span> c1</span><br><span class="line">  LIMIT <span class="number">4</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> c1</span><br><span class="line">LIMIT <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/662c99600ea9cb14033cd5c1.png" alt="eg2"></p>
<p>e.g3：带VIEW和FROM子句子查询的查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1)</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line">  (<span class="keyword">select</span> tmp1.<span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t2) <span class="keyword">as</span> tmp1,</span><br><span class="line">  (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t3 <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> v1) <span class="keyword">as</span> tmp2);</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/662c99600ea9cb14033cd61c.png" alt="eg3"></p>
<p>e.g4：WHERE子句带子查询的查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1 <span class="keyword">where</span> c1 <span class="keyword">in</span> (<span class="keyword">select</span> c2 <span class="keyword">from</span> t2 <span class="keyword">where</span> t2.c1 <span class="operator">&lt;</span> <span class="number">20</span>);</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/662c99600ea9cb14033cd671.png" alt="eg4"></p>
<p>e.g5：普通JOIN查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t3, (t1, t2) <span class="keyword">where</span> t1.c1 <span class="operator">=</span> t2.c2;</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/662c99960ea9cb14033d4d4f.png" alt="eg5"></p>
<p>e.g6：LEFT OUTER JOIN</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1 <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span>(t2, t3) <span class="keyword">on</span> t1.c1 <span class="operator">=</span> t2.c1 <span class="keyword">and</span> t1.c2 <span class="operator">=</span> t3.c2 <span class="keyword">where</span> t1.c1 <span class="operator">=</span> t2.c2;</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.imgdb.cn/item/662c99970ea9cb14033d4dda.png" alt="eg6"></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/02/07/MySQL%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D%EF%BC%9A%E4%BD%BF%E7%94%A8Optimizer_Trace%E5%88%86%E6%9E%90%E4%BC%98%E5%8C%96%E5%99%A8%E8%A1%8C%E4%B8%BA/" rel="prev" title="MySQL功能介绍：使用Optimizer_Trace分析优化器行为">
      <i class="fa fa-chevron-left"></i> MySQL功能介绍：使用Optimizer_Trace分析优化器行为
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/06/09/MySQL%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%9A%E4%BC%98%E5%8C%96%E5%99%A8%E6%B7%B1%E6%BD%9C%EF%BC%88%E4%BA%8C%EF%BC%89%20-%20PREPARE%E7%9A%84%E6%89%A7%E8%A1%8C%E9%80%BB%E8%BE%91/" rel="next" title="MySQL源码分析：优化器深潜（二）- PREPARE的执行逻辑">
      MySQL源码分析：优化器深潜（二）- PREPARE的执行逻辑 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0-%E5%BA%8F"><span class="nav-text">0 序</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="nav-text">1 相关概念</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-query-specification"><span class="nav-text">1.1 query specification</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-query-expression"><span class="nav-text">1.2 query expression</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-%E7%A4%BA%E6%84%8F%E5%9B%BE"><span class="nav-text">1.3 示意图</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E9%87%8D%E8%A6%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-text">2 重要数据结构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-%E6%9F%A5%E8%AF%A2%E5%9D%97Query-block"><span class="nav-text">2.1 查询块Query_block</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E6%9F%A5%E8%AF%A2%E8%A1%A8%E8%BE%BE%E5%BC%8FQuery-expression"><span class="nav-text">2.2 查询表达式Query_expression</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-LEX"><span class="nav-text">2.3 LEX</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-Item"><span class="nav-text">2.4 Item</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-%E8%AF%AD%E6%B3%95%E6%A0%91%E7%A4%BA%E4%BE%8B"><span class="nav-text">3 语法树示例</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lemonacy"
      src="/uploads/avatar.jpg">
  <p class="site-author-name" itemprop="name">lemonacy</p>
  <div class="site-description" itemprop="description">Make Lemons into Lemonade</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:licy0304@163.com" title="E-Mail → mailto:licy0304@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lemonacy</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  











<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




  

  

</body>
</html>
